<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Islamic Wealth Shield by Aayan</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Scheherazade+New:wght@400;700&family=El+Messiri:wght@500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #8e7037;
            --primary-dark: #6e5529;
            --primary-light: #b89c68;
            --secondary: #5d8c5a;
            --secondary-dark: #3e6a40;
            --accent: #b68c5a;
            --light: #f8f4e9;
            --lighter: #fdfaf2;
            --dark: #3d2e1f;
            --darker: #2a1f15;
            --success: #4a7b4d;
            --danger: #a44a3f;
            --card-bg: rgba(255, 255, 255, 0.95);
            --shadow: 0 8px 30px rgba(61, 46, 31, 0.12);
            --transition: all 0.3s ease;
            --gold-gradient: linear-gradient(135deg, #d4af37 0%, #b8860b 100%);
            --geometric-pattern: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path d="M20,20 Q40,5 60,20 T100,20 Q85,40 100,60 T80,100 Q60,85 40,100 T0,80 Q5,60 0,40 T20,20Z" fill="none" stroke="%238e7037" stroke-width="0.5" opacity="0.1"/></svg>');
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Amiri', serif;
            background: linear-gradient(135deg, #f8f4e9 0%, #e8dfc9 100%);
            color: var(--darker);
            line-height: 1.8;
            padding: 20px;
            min-height: 100vh;
            background-image: var(--geometric-pattern);
        }
        
        .container {
            max-width: 1200px;
            margin: 30px auto;
            background: var(--card-bg);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow);
            border: 1px solid rgba(142, 112, 55, 0.15);
            position: relative;
            transition: var(--transition);
        }
        
        .islamic-border {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 15px;
            background: repeating-linear-gradient(
                90deg,
                var(--primary),
                var(--primary) 10px,
                var(--accent) 10px,
                var(--accent) 20px
            );
            z-index: 10;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: #f8f4e9;
            padding: 50px 20px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
            z-index: 2;
        }
        
        header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(255,255,255,0.15) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(255,255,255,0.15) 0%, transparent 20%);
            pointer-events: none;
            z-index: 1;
        }
        
        .brand-container {
            position: relative;
            margin-bottom: 20px;
            padding: 0 20px;
        }
        
        .branding {
            font-family: 'El Messiri', sans-serif;
            font-size: 3.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            position: relative;
            z-index: 2;
            letter-spacing: 1px;
            background: linear-gradient(to right, #f9e076, #d4af37, #b8860b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: glow 2s infinite alternate;
        }
        
        @keyframes glow {
            from { text-shadow: 0 0 5px rgba(249, 224, 118, 0.5); }
            to { text-shadow: 0 0 20px rgba(249, 224, 118, 0.8); }
        }
        
        .subtitle {
            font-size: 1.3rem;
            max-width: 800px;
            margin: 0 auto 20px;
            position: relative;
            z-index: 2;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
            opacity: 0.9;
            font-weight: 500;
        }
        
        .logo-art {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 120px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 0;
        }
        
        .logo-art::before {
            content: "";
            position: absolute;
            width: 100px;
            height: 100px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
        }
        
        .logo-art::after {
            content: "Ôô∏";
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            font-size: 3rem;
            color: rgba(255, 255, 255, 0.15);
        }
        
        .content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
            padding: 30px;
        }
        
        @media (min-width: 992px) {
            .content {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        .input-section {
            background: var(--lighter);
            border-radius: 15px;
            padding: 30px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(142, 112, 55, 0.1);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }
        
        .input-section::before {
            content: "";
            position: absolute;
            top: 0;
            right: 0;
            width: 80px;
            height: 80px;
            background: var(--geometric-pattern);
            opacity: 0.05;
            z-index: -1;
        }
        
        .input-section:hover {
            box-shadow: 0 12px 35px rgba(61, 46, 31, 0.15);
            transform: translateY(-5px);
        }
        
        .input-group {
            margin-bottom: 25px;
            position: relative;
        }
        
        .input-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 700;
            color: var(--dark);
            font-size: 1.15rem;
            position: relative;
            padding-left: 8px;
            display: flex;
            align-items: center;
        }
        
        .input-group label::before {
            content: "";
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 70%;
            background: var(--primary);
            border-radius: 2px;
        }
        
        .input-group i.info-icon {
            margin-left: 8px;
            color: var(--primary);
            font-size: 0.9rem;
            cursor: help;
        }
        
        .input-group input, .input-group select {
            width: 100%;
            padding: 16px 20px 16px 50px;
            border: 2px solid #d8c9a6;
            border-radius: 12px;
            font-size: 1.1rem;
            transition: var(--transition);
            background: white;
            font-family: 'Amiri', serif;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.06);
            color: var(--darker);
        }
        
        .input-group input:focus, .input-group select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 4px rgba(142, 112, 55, 0.2), inset 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .input-group .input-icon {
            position: relative;
        }
        
        .input-group .input-icon i {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary);
            z-index: 2;
            font-size: 1.2rem;
        }
        
        .btn {
            display: block;
            width: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            padding: 18px;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 15px;
            box-shadow: 0 6px 15px rgba(142, 112, 55, 0.4);
            font-family: 'Scheherazade New', serif;
            letter-spacing: 1px;
            position: relative;
            z-index: 2;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: 0.5s;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(142, 112, 55, 0.6);
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn i {
            margin-right: 10px;
        }
        
        .results-section {
            display: none;
            background: rgba(248, 244, 233, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(142, 112, 55, 0.1);
            animation: fadeIn 0.8s ease;
            position: relative;
            overflow: hidden;
        }
        
        .results-section::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--geometric-pattern);
            opacity: 0.03;
            z-index: 0;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .card-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .card {
            border-radius: 15px;
            padding: 25px;
            color: var(--dark);
            box-shadow: var(--shadow);
            background: var(--card-bg);
            border: 1px solid rgba(142, 112, 55, 0.1);
            position: relative;
            overflow: hidden;
            transition: var(--transition);
            animation: float 6s ease-in-out infinite;
            z-index: 1;
        }
        
        .card::after {
            content: "";
            position: absolute;
            top: 0;
            right: 0;
            width: 80px;
            height: 80px;
            background: var(--geometric-pattern);
            opacity: 0.05;
            z-index: -1;
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(61, 46, 31, 0.15);
        }
        
        .card::before {
            content: "";
            position: absolute;
            top: 0;
            right: 0;
            width: 60px;
            height: 60px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="%238e7037" opacity="0.1" d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4Z"/></svg>');
            background-size: contain;
            background-repeat: no-repeat;
            opacity: 0.2;
        }
        
        .card h3 {
            font-size: 1.6rem;
            margin-bottom: 18px;
            color: var(--primary);
            font-family: 'Scheherazade New', serif;
            border-bottom: 3px solid var(--accent);
            padding-bottom: 12px;
            display: flex;
            align-items: center;
        }
        
        .card h3 i {
            margin-right: 12px;
            font-size: 1.4rem;
        }
        
        .card .value {
            font-size: 2.4rem;
            font-weight: 700;
            margin: 15px 0;
            color: var(--secondary);
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            background: var(--gold-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .card p {
            margin: 10px 0;
            font-size: 1.1rem;
            line-height: 1.6;
        }
        
        .table-container {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid rgba(142, 112, 55, 0.1);
            max-height: 400px;
            overflow-y: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-family: 'Amiri', serif;
        }
        
        th {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 18px;
            text-align: center;
            font-weight: 600;
            font-size: 1.15rem;
            position: sticky;
            top: 0;
        }
        
        td {
            padding: 16px;
            text-align: center;
            border-bottom: 1px solid #eee;
            font-size: 1.05rem;
        }
        
        tr:nth-child(even) {
            background-color: #fbf8f0;
        }
        
        tr:hover {
            background-color: #f5f0e3;
        }
        
        .optimal-row {
            background-color: #f0f5e9 !important;
            font-weight: 600;
            box-shadow: inset 0 0 0 2px var(--success);
        }
        
        .success {
            color: var(--success);
            font-weight: 600;
        }
        
        .danger {
            color: var(--danger);
        }
        
        .info-box {
            background: #f0f5e9;
            border-left: 5px solid var(--success);
            border-radius: 12px;
            padding: 25px;
            margin-top: 25px;
            position: relative;
            overflow: hidden;
        }
        
        .info-box::before {
            content: "‚ÑπÔ∏è";
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 3rem;
            opacity: 0.1;
            z-index: 0;
        }
        
        .info-box h3 {
            margin-bottom: 15px;
            color: var(--success);
            font-size: 1.4rem;
            display: flex;
            align-items: center;
        }
        
        .info-box h3 i {
            margin-right: 10px;
        }
        
        .math-correction {
            background: #fdf6e9;
            border-left: 5px solid var(--accent);
            padding: 20px;
            border-radius: 10px;
            margin: 25px 0;
            position: relative;
        }
        
        .math-correction h4 {
            color: var(--accent);
            margin-bottom: 12px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
        }
        
        .math-correction h4 i {
            margin-right: 10px;
        }
        
        footer {
            text-align: center;
            padding: 25px;
            color: var(--dark);
            font-size: 1rem;
            margin-top: 30px;
            background: rgba(142, 112, 55, 0.05);
            border-top: 1px solid rgba(142, 112, 55, 0.1);
            border-radius: 0 0 20px 20px;
        }
        
        .results-header {
            text-align: center;
            margin: 25px 0;
            color: var(--primary);
            font-size: 2.3rem;
            font-family: 'Scheherazade New', serif;
            position: relative;
            display: inline-block;
            padding: 0 20px;
        }
        
        .results-header::after, .results-header::before {
            content: "";
            position: absolute;
            top: 50%;
            width: 100px;
            height: 4px;
            background: var(--accent);
            border-radius: 2px;
        }
        
        .results-header::after {
            left: 100%;
        }
        
        .results-header::before {
            right: 100%;
        }
        
        .badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .badge-success {
            background: var(--success);
            color: white;
        }
        
        .badge-primary {
            background: var(--primary);
            color: white;
        }
        
        .mode-selector {
            display: flex;
            justify-content: center;
            margin-bottom: 25px;
            gap: 15px;
            flex-wrap: wrap;
            position: relative;
            z-index: 2;
        }
        
        .mode-btn {
            padding: 14px 25px;
            border-radius: 12px;
            background: var(--light);
            border: 2px solid var(--primary);
            color: var(--primary);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-family: 'Scheherazade New', serif;
            font-size: 1.1rem;
            position: relative;
            z-index: 2;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
        }
        
        .mode-btn i {
            margin-right: 8px;
            font-size: 1.2rem;
        }
        
        .mode-btn.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 15px rgba(142, 112, 55, 0.4);
        }
        
        .mode-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
        }
        
        .mode-section {
            display: none;
        }
        
        .mode-section.active {
            display: block;
            animation: fadeIn 0.6s ease;
        }
        
        .nisab-info {
            background: #f0f5e9;
            border-left: 5px solid var(--success);
            padding: 18px;
            border-radius: 10px;
            margin: 18px 0;
        }
        
        .nisab-info h4 {
            color: var(--success);
            margin-bottom: 10px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
        }
        
        .nisab-info h4 i {
            margin-right: 10px;
        }
        
        .payment-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 18px;
            margin-top: 25px;
        }
        
        .payment-option {
            background: white;
            border-radius: 12px;
            padding: 18px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(142, 112, 55, 0.1);
            transition: transform 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .payment-option::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: var(--primary);
        }
        
        .payment-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0,0,0,0.1);
        }
        
        .payment-option h4 {
            margin-bottom: 12px;
            color: var(--primary);
            font-family: 'Scheherazade New', serif;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
        }
        
        .payment-option h4 i {
            margin-right: 10px;
            font-size: 1.2rem;
        }
        
        .zakat-calendar {
            background: #fdf6e9;
            border-radius: 12px;
            padding: 18px;
            margin-top: 25px;
            border-left: 5px solid var(--accent);
            position: relative;
        }
        
        .zakat-calendar::before {
            content: "üìÖ";
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 2.5rem;
            opacity: 0.1;
            z-index: 0;
        }
        
        .zakat-calendar h4 {
            color: var(--accent);
            margin-bottom: 12px;
            font-family: 'Scheherazade New', serif;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
        }
        
        .zakat-calendar h4 i {
            margin-right: 10px;
        }
        
        .zakat-date {
            margin: 8px 0;
            padding: 8px;
            border-bottom: 1px dashed #d8c9a6;
            position: relative;
            z-index: 1;
        }
        
        .weight-converter {
            display: flex;
            gap: 12px;
            margin-top: 15px;
        }
        
        .weight-converter input {
            flex: 1;
            padding: 12px;
            border: 1px solid #d8c9a6;
            border-radius: 8px;
            font-family: 'Amiri', serif;
            font-size: 1rem;
            background: white;
        }
        
        .weight-converter button {
            padding: 12px 18px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Amiri', serif;
            font-size: 1rem;
            transition: background 0.3s;
            font-weight: 600;
        }
        
        .weight-converter button:hover {
            background: var(--primary);
        }
        
        .disclaimer {
            font-size: 0.9rem;
            color: var(--dark);
            margin-top: 25px;
            padding: 18px;
            background: #fdf6e9;
            border-radius: 10px;
            border: 1px solid rgba(142, 112, 55, 0.2);
        }
        
        .disclaimer strong {
            color: var(--danger);
        }
        
        .print-btn {
            background: linear-gradient(135deg, var(--secondary) 0%, #4a7b4d 100%) !important;
            margin-top: 25px;
        }
        
        .region-selector {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            position: relative;
            z-index: 2;
        }
        
        .region-btn {
            padding: 10px 18px;
            border-radius: 25px;
            background: var(--light);
            border: 2px solid var(--primary);
            color: var(--primary);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
            position: relative;
            z-index: 2;
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
        }
        
        .region-btn i {
            margin-right: 8px;
        }
        
        .region-btn.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 12px rgba(142, 112, 55, 0.4);
        }
        
        .region-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 12px rgba(0,0,0,0.15);
        }
        
        .preset-selector {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            position: relative;
            z-index: 2;
        }
        
        .preset-btn {
            padding: 8px 15px;
            border-radius: 18px;
            background: #f0f0e0;
            border: 1px solid #d8c9a6;
            color: var(--dark);
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            z-index: 2;
            font-weight: 500;
        }
        
        .preset-btn:hover {
            background: #e0e0d0;
        }
        
        .preset-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 3px 8px rgba(142, 112, 55, 0.3);
        }
        
        .signature {
            font-family: 'Scheherazade New', serif;
            color: var(--primary);
            font-size: 1.3rem;
            margin-top: 15px;
            text-align: center;
            font-style: italic;
        }
        
        .section-title {
            position: relative;
            padding-bottom: 12px;
            margin-bottom: 25px;
            font-family: 'Scheherazade New', serif;
            color: var(--primary);
            z-index: 2;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
        }
        
        .section-title i {
            margin-right: 12px;
            font-size: 1.5rem;
        }
        
        .section-title::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 4px;
            background: var(--accent);
            border-radius: 2px;
        }
        
        .status-indicator {
            position: fixed;
            top: 25px;
            right: 25px;
            background: var(--success);
            color: white;
            padding: 12px 18px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            display: none;
            font-size: 1.1rem;
            animation: slideIn 0.4s ease, fadeOut 0.4s ease 2s forwards;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes fadeOut {
            to { opacity: 0; }
        }
        
        .pdf-btn {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-dark) 100%) !important;
            margin-top: 15px;
        }
        
        .pdf-btn:hover {
            background: linear-gradient(135deg, #3e6a40 0%, #3d653f 100%) !important;
        }
        
        .receipt-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 2000;
            overflow: auto;
            padding: 30px;
        }
        
        .receipt-content {
            max-width: 800px;
            margin: 40px auto;
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.4);
            position: relative;
            animation: popIn 0.5s ease;
        }
        
        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .close-receipt {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .close-receipt:hover {
            background: #8c3c32;
            transform: rotate(90deg);
        }
        
        .receipt-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid var(--primary);
        }
        
        .receipt-logo {
            font-size: 3.5rem;
            color: var(--primary);
            margin-bottom: 15px;
        }
        
        .receipt-title {
            font-size: 2.2rem;
            color: var(--primary);
            font-family: 'Scheherazade New', serif;
            margin-bottom: 10px;
        }
        
        .receipt-date {
            text-align: right;
            margin-bottom: 25px;
            color: #666;
            font-size: 1.1rem;
        }
        
        .receipt-details {
            margin: 30px 0;
            padding: 25px;
            border: 2px solid #eee;
            border-radius: 12px;
            font-size: 1.1rem;
            line-height: 1.8;
        }
        
        .receipt-details h3 {
            color: var(--primary);
            margin-bottom: 15px;
            font-family: 'Scheherazade New', serif;
            font-size: 1.6rem;
            border-bottom: 2px solid var(--accent);
            padding-bottom: 10px;
        }
        
        .receipt-details p {
            margin: 12px 0;
        }
        
        .receipt-details .value {
            font-weight: 700;
            color: var(--secondary);
            font-size: 1.2rem;
        }
        
        .receipt-footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            color: #666;
            font-size: 1rem;
        }
        
        .download-btn {
            display: block;
            width: 100%;
            max-width: 300px;
            margin: 30px auto 0;
            background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-dark) 100%);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .download-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: 0.5s;
        }
        
        .download-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(74, 123, 77, 0.5);
        }
        
        .download-btn:hover::before {
            left: 100%;
        }
        
        .gold-glow {
            animation: gold-glow 2s infinite alternate;
        }
        
        @keyframes gold-glow {
            0% { box-shadow: 0 0 5px rgba(142, 112, 55, 0.5); }
            100% { box-shadow: 0 0 20px rgba(142, 112, 55, 0.8); }
        }
        
        .floating {
            animation: floating 3s ease-in-out infinite;
        }
        
        @keyframes floating {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        /* Input validation */
        .input-error {
            border-color: var(--danger) !important;
            animation: shake 0.5s;
        }
        
        .error-message {
            color: var(--danger);
            font-size: 0.9rem;
            margin-top: 5px;
            display: none;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        /* Loading indicator */
        .loader {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .loader .spinner {
            border: 4px solid rgba(142, 112, 55, 0.2);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* References section */
        .references {
            background: #f0f5e9;
            border-radius: 12px;
            padding: 20px;
            margin-top: 30px;
            border-left: 5px solid var(--success);
            position: relative;
        }
        
        .references::before {
            content: "üìñ";
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 2.5rem;
            opacity: 0.1;
            z-index: 0;
        }
        
        .references h3 {
            color: var(--success);
            margin-bottom: 15px;
            font-family: 'Scheherazade New', serif;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            position: relative;
            z-index: 1;
        }
        
        .references h3 i {
            margin-right: 10px;
        }
        
        .references ul {
            padding-left: 20px;
            position: relative;
            z-index: 1;
        }
        
        .references li {
            margin-bottom: 10px;
        }
        
        /* Chart container */
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 30px 0;
            box-shadow: var(--shadow);
            height: 350px;
            position: relative;
            border: 1px solid rgba(142, 112, 55, 0.1);
        }
        
        /* Tooltips */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background-color: var(--dark);
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.9rem;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        /* Progress bar */
        .progress-container {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            border-radius: 4px;
            transition: width 0.5s;
        }
        
        /* Toggle switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
            margin: 0 10px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background: linear-gradient(90deg, var(--primary), var(--accent));
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        /* Calculation explanation */
        .explanation {
            background: rgba(248, 244, 233, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-top: 25px;
            border-left: 4px solid var(--accent);
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        
        .explanation h3 {
            color: var(--primary);
            margin-bottom: 15px;
            font-family: 'Scheherazade New', serif;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
        }
        
        .explanation h3 i {
            margin-right: 12px;
            font-size: 1.5rem;
        }
        
        .explanation ul {
            padding-left: 20px;
            margin-top: 10px;
        }
        
        .explanation li {
            margin-bottom: 12px;
            position: relative;
            padding-left: 10px;
        }
        
        .explanation li::before {
            content: "‚Ä¢";
            position: absolute;
            left: 0;
            color: var(--primary);
            font-size: 1.2rem;
        }
        
        .term-highlight {
            background-color: rgba(142, 112, 55, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
            border: 1px dashed var(--primary);
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
                padding: 20px;
            }
            header {
                padding: 40px 15px 25px;
            }
            .branding {
                font-size: 2.2rem;
            }
            .card-container {
                grid-template-columns: 1fr;
            }
            .payment-options {
                grid-template-columns: 1fr;
            }
            .input-row {
                flex-direction: column;
                gap: 15px;
            }
            .region-selector, .mode-selector {
                flex-wrap: wrap;
            }
            .mode-btn {
                padding: 12px 20px;
                font-size: 1rem;
            }
            .results-header {
                font-size: 1.8rem;
            }
            .section-title {
                font-size: 1.6rem;
            }
            .chart-container {
                height: 250px;
            }
            .results-header::after, .results-header::before {
                width: 50px;
            }
            .explanation {
                padding: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .branding {
                font-size: 1.8rem;
            }
            .subtitle {
                font-size: 1.1rem;
            }
            .mode-selector {
                flex-direction: column;
            }
            .region-selector {
                flex-direction: column;
            }
            .mode-btn {
                width: 100%;
            }
            .region-btn {
                width: 100%;
            }
            .chart-container {
                height: 200px;
            }
            .results-header::after, .results-header::before {
                width: 30px;
            }
            .weight-converter {
                flex-direction: column;
            }
        }
        
        /* New Elements */
        .calculation-progress {
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            overflow: hidden;
            margin: 20px 0;
            position: relative;
            display: none;
        }
        
        .progress-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        
        .flourish {
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            opacity: 0.05;
            background-image: 
                radial-gradient(circle, var(--primary) 1px, transparent 2px);
            background-size: 20px 20px;
            pointer-events: none;
        }
        
        .success-animation {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        
        .success-animation i {
            font-size: 3rem;
            color: var(--success);
            animation: bounce 1s;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-20px);}
            60% {transform: translateY(-10px);}
        }
        
        .section-divider {
            height: 1px;
            background: linear-gradient(to right, transparent, var(--primary-light), transparent);
            margin: 30px 0;
        }
        
        .help-toggle {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--primary-light);
            color: var(--darker);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 3;
        }
        
        .help-content {
            background: rgba(248, 244, 233, 0.9);
            border-radius: 10px;
            padding: 15px;
            margin-top: 10px;
            display: none;
            border-left: 3px solid var(--primary);
        }
        
        /* New design fixes */
        .input-group .error-message {
            font-size: 0.85rem;
            margin-top: 8px;
        }
        
        .card-container {
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        }
        
        .card .value {
            font-size: 2.2rem;
        }
        
        .nisab-info p {
            font-size: 1.05rem;
        }
        
        .math-correction p {
            font-size: 1.05rem;
        }
        
        .disclaimer p {
            font-size: 0.95rem;
        }
        
        .table-container {
            max-height: 350px;
        }
        
        .info-box p {
            font-size: 1.05rem;
        }
        
        /* Coverage projection improvements */
        .coverage-explanation {
            background: #f9f5e9;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid var(--primary);
        }
        
        .coverage-explanation h4 {
            color: var(--primary);
            margin-bottom: 12px;
            font-family: 'Scheherazade New', serif;
            display: flex;
            align-items: center;
        }
        
        .coverage-explanation h4 i {
            margin-right: 10px;
        }
        
        .coverage-explanation ul {
            padding-left: 20px;
        }
        
        .coverage-explanation li {
            margin-bottom: 10px;
            position: relative;
        }
        
        .coverage-explanation li::before {
            content: "‚Ä¢";
            position: absolute;
            left: -15px;
            color: var(--primary);
        }
        
        /* Footer link */
        .footer-link {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .footer-link:hover {
            color: var(--primary-dark);
            text-decoration: underline;
        }
        
        /* Enhanced tooltips */
        .info-icon {
            position: relative;
            display: inline-block;
        }
        
        .info-icon .tooltip-content {
            visibility: hidden;
            width: 250px;
            background-color: var(--dark);
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 15px;
            position: absolute;
            z-index: 100;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.9rem;
            line-height: 1.5;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .info-icon:hover .tooltip-content {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="status-indicator" id="status">Mode changed successfully!</div>
    <div class="loader" id="loader">
        <div class="spinner"></div>
        <p>Calculating your wealth preservation strategy...</p>
    </div>
    
    <div class="receipt-container" id="receiptContainer">
        <div class="receipt-content" id="receiptContent">
            <button class="close-receipt" onclick="closeReceipt()">&times;</button>
            <div class="receipt-header">
                <div class="receipt-logo"><i class="fas fa-mosque"></i></div>
                <h1 class="receipt-title">Islamic Wealth Shield</h1>
                <p>Shariah-compliant Wealth Solutions</p>
            </div>
            <div class="receipt-date" id="receiptDate"></div>
            <div class="receipt-details" id="receiptDetails"></div>
            <button class="download-btn" onclick="downloadPDF()">
                <i class="fas fa-download"></i> Download PDF Receipt
            </button>
            <div class="receipt-footer">
                <p>This document is generated by Islamic Wealth Shield by Aayan</p>
                <p>¬© 2025 Islamic Finance Solutions. All calculations are estimates.</p>
            </div>
        </div>
    </div>
    
    <div class="container gold-glow">
        <div class="islamic-border"></div>
        <header>
            <div class="logo-art"></div>
            <div class="brand-container">
                <h1 class="branding floating">Islamic Wealth Shield</h1>
                <p class="subtitle">Shariah-compliant solutions to preserve your gold wealth while fulfilling zakat obligations</p>
            </div>
            
            <div class="mode-selector">
                <button class="mode-btn active" data-mode="comparison"><i class="fas fa-balance-scale"></i> Gold vs SIP</button>
                <button class="mode-btn" data-mode="zakat"><i class="fas fa-hand-holding-usd"></i> Zakat Calculator</button>
                <button class="mode-btn" data-mode="planner"><i class="fas fa-piggy-bank"></i> SIP Planner</button>
            </div>
        </header>
        
        <div class="content">
            <div class="input-section">
                <div class="flourish"></div>
                <div class="region-selector">
                    <button class="region-btn active" data-region="pak"><i class="fas fa-mosque"></i> Pakistan</button>
                    <button class="region-btn" data-region="ind"><i class="fas fa-rupee-sign"></i> India</button>
                    <button class="region-btn" data-region="bang"><i class="fas fa-taka-sign"></i> Bangladesh</button>
                    <button class="region-btn" data-region="uae"><i class="fas fa-dirham-sign"></i> UAE</button>
                    <button class="region-btn" data-region="us"><i class="fas fa-dollar-sign"></i> USA/Int'l</button>
                </div>
                
                <!-- Gold vs SIP Comparison Mode -->
                <div class="mode-section active" id="comparison-mode">
                    <div class="help-toggle">
                        <i class="fas fa-question"></i>
                    </div>
                    <div class="help-content">
                        <p>This mode compares different strategies for preserving wealth through gold and Shariah-compliant investments while accounting for zakat obligations.</p>
                    </div>
                    
                    <h2 class="section-title"><i class="fas fa-sliders-h"></i> Gold vs SIP Parameters</h2>
                    
                    <div class="preset-selector">
                        <button class="preset-btn" data-preset="conservative">Conservative</button>
                        <button class="preset-btn" data-preset="moderate">Moderate</button>
                        <button class="preset-btn active" data-preset="aggressive">Aggressive</button>
                        <button class="preset-btn" data-preset="custom">Custom</button>
                    </div>
                    
                    <div class="math-correction">
                        <h4><i class="fas fa-exclamation-triangle"></i> Math Corrections Applied:</h4>
                        <p>‚Ä¢ Zakat calculated on <strong>end-of-year</strong> gold value<br>
                        ‚Ä¢ Zakat payments deducted from SIP<br>
                        ‚Ä¢ Gold-only scenario deducts zakat annually</p>
                    </div>
                    
                    <div class="input-group">
                        <label>Total Investment (<span id="currency-symbol">‚Ç®</span>) <i class="fas fa-info-circle info-icon"><span class="tooltip-content">Enter the total amount you plan to invest in gold and Shariah-compliant investments</span></i></label>
                        <div class="input-icon">
                            <i class="fas" id="currency-icon">‚Ç®</i>
                            <input type="number" id="total" value="1000000" min="1000" max="1000000000">
                        </div>
                        <div class="error-message" id="total-error">Please enter a valid amount (min: 1,000)</div>
                    </div>
                    
                    <div class="input-row">
                        <div class="input-group">
                            <label>Zakat % p.a. <i class="fas fa-info-circle info-icon"><span class="tooltip-content">Standard zakat rate is 2.5% of your wealth above nisab threshold</span></i></label>
                            <div class="input-icon">
                                <i class="fas fa-percentage"></i>
                                <input type="number" id="zakat" value="2.5" step="0.1" min="0" max="10">
                            </div>
                            <div class="error-message" id="zakat-error">Zakat must be between 0-10%</div>
                        </div>
                        
                        <div class="input-group">
                            <label>Years <i class="fas fa-info-circle info-icon"><span class="tooltip-content">Investment duration in years for the comparison</span></i></label>
                            <div class="input-icon">
                                <i class="fas fa-calendar-alt"></i>
                                <input type="number" id="yrs" value="10" min="1" max="50">
                            </div>
                            <div class="error-message" id="yrs-error">Years must be between 1-50</div>
                        </div>
                    </div>
                    
                    <div class="input-row">
                        <div class="input-group">
                            <label>SIP Return % p.a. <i class="fas fa-info-circle info-icon"><span class="tooltip-content">Expected annual return on Shariah-compliant investments (historically 8-15%)</span></i></label>
                            <div class="input-icon">
                                <i class="fas fa-chart-line"></i>
                                <input type="number" id="sipR" value="12" step="0.1" min="-10" max="50">
                            </div>
                            <div class="error-message" id="sipR-error">Return must be between -10% and 50%</div>
                        </div>
                        
                        <div class="input-group">
                            <label>Gold Return % p.a. <i class="fas fa-info-circle info-icon"><span class="tooltip-content">Expected annual appreciation of gold (historically 6-10%)</span></i></label>
                            <div class="input-icon">
                                <i class="fas fa-coins"></i>
                                <input type="number" id="goldR" value="8" step="0.1" min="-10" max="50">
                            </div>
                            <div class="error-message" id="goldR-error">Return must be between -10% and 50%</div>
                        </div>
                    </div>
                    
                    <div class="calculation-progress" id="progressBar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    
                    <button class="btn" onclick="runComparison()">
                        <i class="fas fa-calculator"></i> Compare Strategies
                    </button>
                    
                    <div class="explanation">
                        <h3><i class="fas fa-calculator"></i> How the Comparison Works</h3>
                        <p>This calculator helps you find the optimal balance between gold and Shariah-compliant investments to preserve your wealth while fulfilling zakat obligations.</p>
                        
                        <ul>
                            <li><span class="term-highlight">Zakat Calculation:</span> We calculate zakat on your gold holdings at the end of each year at the specified rate (typically 2.5%).</li>
                            <li><span class="term-highlight">Gold Preservation:</span> Instead of selling gold to pay zakat, we use income from investments to cover zakat payments.</li>
                            <li><span class="term-highlight">Investment Growth:</span> SIP investments grow at the specified annual rate, providing funds for zakat payments.</li>
                            <li><span class="term-highlight">Optimal Strategy:</span> We test different gold/SIP allocations to find the highest gold percentage where the SIP can cover all zakat obligations throughout the investment period.</li>
                            <li><span class="term-highlight">Wealth Preservation:</span> The strategy preserves your gold holdings while using investment returns to fulfill religious obligations.</li>
                        </ul>
                    </div>
                    
                    <div class="references">
                        <h3><i class="fas fa-book"></i> Islamic References</h3>
                        <ul>
                            <li>Zakat on gold is obligatory when it reaches the nisab value (87.48 grams) - Sahih Bukhari</li>
                            <li>Gold is zakatable at 2.5% annually - Quran (9:60)</li>
                            <li>Islamic finance prohibits interest (riba) - Quran (2:275)</li>
                            <li>Preserving wealth is encouraged in Islam - Hadith</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Zakat Calculator Mode -->
                <div class="mode-section" id="zakat-mode">
                    <div class="help-toggle">
                        <i class="fas fa-question"></i>
                    </div>
                    <div class="help-content">
                        <p>Calculate your zakat obligations on gold assets according to Islamic principles.</p>
                    </div>
                    
                    <h2 class="section-title"><i class="fas fa-hand-holding-usd"></i> Zakat Calculator</h2>
                    
                    <div class="nisab-info">
                        <h4><i class="fas fa-info-circle"></i> Nisab Threshold</h4>
                        <p>Zakat is obligatory when gold exceeds 87.48 grams (7.5 tola) of pure gold. Below this amount, no zakat is due on gold. The nisab is calculated based on the current value of 87.48 grams of pure gold.</p>
                    </div>
                    
                    <div class="input-group">
                        <label>Gold Weight (grams) <i class="fas fa-info-circle info-icon"><span class="tooltip-content">Total weight of gold you own. 1 tola = 11.664 grams. Enter the total weight in grams.</span></i></label>
                        <div class="input-icon">
                            <i class="fas fa-weight-hanging"></i>
                            <input type="number" id="goldWeight" value="100" step="0.1" min="0" max="10000">
                        </div>
                        <div class="error-message" id="goldWeight-error">Please enter a valid weight</div>
                        
                        <div class="weight-converter">
                            <input type="number" id="tolaInput" placeholder="Enter tola to convert" step="0.1">
                            <button onclick="convertTolaToGram()">Convert Tola to Grams</button>
                        </div>
                        <p class="disclaimer">Note: Conversion uses standard 1 tola = 11.664g. Actual purity may vary.</p>
                    </div>
                    
                    <div class="input-group">
                        <label>Current Gold Rate (<span class="currency-symbol">‚Ç®</span>/gram) <i class="fas fa-info-circle info-icon"><span class="tooltip-content">Current market price per gram of pure (24K) gold in your local currency</span></i></label>
                        <div class="input-icon">
                            <i class="fas" id="gold-rate-icon">‚Ç®</i>
                            <input type="number" id="goldRate" value="18867" step="1" min="1" max="1000000">
                        </div>
                        <div class="error-message" id="goldRate-error">Please enter a valid rate</div>
                    </div>
                    
                    <div class="input-group">
                        <label>Zakat Rate (%) <i class="fas fa-info-circle info-icon"><span class="tooltip-content">Standard zakat rate is 2.5% of your wealth above nisab threshold</span></i></label>
                        <div class="input-icon">
                                <i class="fas fa-percentage"></i>
                                <input type="number" id="zakatRate" value="2.5" step="0.1" min="0" max="10">
                            </div>
                            <div class="error-message" id="zakatRate-error">Zakat must be between 0-10%</div>
                        </div>
                        
                        <div class="input-group">
                            <label>Other Zakatable Assets (<span class="currency-symbol">‚Ç®</span>) <i class="fas fa-info-circle info-icon"><span class="tooltip-content">Cash, savings, investments, and other assets you've held for at least one lunar year</span></i></label>
                            <div class="input-icon">
                                <i class="fas fa-wallet"></i>
                                <input type="number" id="otherAssets" value="0" min="0">
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <label>Gold Purity (Karat) <i class="fas fa-info-circle info-icon"><span class="tooltip-content">Pure gold is 24K. Standard jewelry is 22K (91.7% pure). Adjust for purity when calculating zakat.</span></i></label>
                            <div class="input-icon">
                                <i class="fas fa-gem"></i>
                                <select id="goldPurity">
                                    <option value="24">24K (Pure Gold)</option>
                                    <option value="22" selected>22K (Standard)</option>
                                    <option value="18">18K</option>
                                    <option value="14">14K</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="calculation-progress" id="zakatProgressBar">
                            <div class="progress-fill" id="zakatProgressFill"></div>
                        </div>
                        
                        <button class="btn" onclick="calculateZakat()">
                            <i class="fas fa-calculator"></i> Calculate Zakat
                        </button>
                        
                        <div class="explanation">
                            <h3><i class="fas fa-calculator"></i> How Zakat is Calculated</h3>
                            <p>This calculator determines your zakat obligations based on Islamic principles:</p>
                            
                            <ul>
                                <li><span class="term-highlight">Nisab Threshold:</span> Zakat is only obligatory if your gold exceeds the nisab value (87.48 grams of pure gold).</li>
                                <li><span class="term-highlight">Purity Adjustment:</span> Gold purity is adjusted to pure gold equivalent (e.g., 22K gold is 91.7% pure).</li>
                                <li><span class="term-highlight">Zakatable Value:</span> Total zakatable wealth includes both gold value and other assets (cash, investments).</li>
                                <li><span class="term-highlight">Zakat Rate:</span> Standard zakat rate is 2.5% of your total zakatable wealth above the nisab threshold.</li>
                                <li><span class="term-highlight">Payment Options:</span> You can pay zakat in cash, equivalent gold weight, or invest in a SIP to cover future obligations.</li>
                            </ul>
                        </div>
                        
                        <div class="zakat-calendar">
                            <h4><i class="fas fa-calendar-alt"></i> Favorable Zakat Months</h4>
                            <p>These months are particularly virtuous for paying zakat:</p>
                            <div class="zakat-date">Ramadan (Islamic Calendar)</div>
                            <div class="zakat-date">Dhul-Hijjah (Islamic Calendar)</div>
                            <div class="zakat-date">Muharram (Islamic New Year)</div>
                        </div>
                        
                        <div class="references">
                            <h3><i class="fas fa-book"></i> Islamic References</h3>
                            <ul>
                                <li>"Take from their wealth charity to purify them" - Quran (9:103)</li>
                                <li>Gold nisab is 87.48 grams of pure gold - Sahih Muslim</li>
                                <li>Zakat is payable on wealth held for one lunar year - Fiqh texts</li>
                                <li>Zakat purifies wealth and increases blessings - Hadith</li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- Zakat SIP Planner Mode -->
                    <div class="mode-section" id="planner-mode">
                        <div class="help-toggle">
                            <i class="fas fa-question"></i>
                        </div>
                        <div class="help-content">
                            <p>Plan your Systematic Investment Plan (SIP) to cover future zakat obligations while preserving your wealth.</p>
                        </div>
                        
                        <h2 class="section-title"><i class="fas fa-piggy-bank"></i> Zakat SIP Planner</h2>
                        
                        <div class="preset-selector">
                            <button class="preset-btn" data-preset="shortterm">Short-term (5y)</button>
                            <button class="preset-btn active" data-preset="mediumterm">Medium-term (10y)</button>
                            <button class="preset-btn" data-preset="longterm">Long-term (20y)</button>
                            <button class="preset-btn" data-preset="customplan">Custom</button>
                        </div>
                        
                        <div class="input-group">
                            <label>Annual Zakat Obligation (<span class="currency-symbol">‚Ç®</span>) <i class="fas fa-info-circle info-icon"><span class="tooltip-content">Your current annual zakat payment. This will increase each year based on inflation rate.</span></i></label>
                            <div class="input-icon">
                                <i class="fas" id="zakat-amount-icon">‚Ç®</i>
                                <input type="number" id="annualZakat" value="15000" min="0" max="100000000">
                            </div>
                            <div class="error-message" id="annualZakat-error">Please enter a valid amount</div>
                        </div>
                        
                        <div class="input-row">
                            <div class="input-group">
                                <label>Years to Cover <i class="fas fa-info-circle info-icon"><span class="tooltip-content">Duration you want this investment to cover your zakat obligations</span></i></label>
                                <div class="input-icon">
                                    <i class="fas fa-calendar-alt"></i>
                                    <input type="number" id="coverYears" value="10" min="1" max="50">
                                </div>
                                <div class="error-message" id="coverYears-error">Years must be between 1-50</div>
                            </div>
                            
                            <div class="input-group">
                                <label>SIP Return % p.a. <i class="fas fa-info-circle info-icon"><span class="tooltip-content">Expected annual return on Shariah-compliant investments (historically 8-15%)</span></i></label>
                                <div class="input-icon">
                                    <i class="fas fa-chart-line"></i>
                                    <input type="number" id="sipReturn" value="12" step="0.1" min="-10" max="50">
                                </div>
                                <div class="error-message" id="sipReturn-error">Return must be between -10% and 50%</div>
                            </div>
                        </div>
                        
                        <div class="input-row">
                            <div class="input-group">
                                <label>Zakat Inflation % p.a. <i class="fas fa-info-circle info-icon"><span class="tooltip-content">Expected annual increase in your zakat obligation (typically matches gold appreciation)</span></i></label>
                                <div class="input-icon">
                                    <i class="fas fa-percentage"></i>
                                    <input type="number" id="zakatInflation" value="8" step="0.1" min="0" max="50">
                                </div>
                                <div class="error-message" id="zakatInflation-error">Inflation must be between 0-50%</div>
                            </div>
                            
                            <div class="input-group">
                                <label>Safety Buffer (%) <i class="fas fa-info-circle info-icon"><span class="tooltip-content">Extra cushion (20-30% recommended) to account for market volatility and higher-than-expected inflation</span></i></label>
                                <div class="input-icon">
                                    <i class="fas fa-shield-alt"></i>
                                    <input type="number" id="safetyBuffer" value="20" step="1" min="0" max="100">
                                </div>
                                <div class="error-message" id="safetyBuffer-error">Buffer must be between 0-100%</div>
                            </div>
                        </div>
                        
                        <div class="calculation-progress" id="sipProgressBar">
                            <div class="progress-fill" id="sipProgressFill"></div>
                        </div>
                        
                        <button class="btn" onclick="planSIP()">
                            <i class="fas fa-calculator"></i> Plan SIP
                        </button>
                        
                        <div class="explanation">
                            <h3><i class="fas fa-calculator"></i> How the SIP Planner Works</h3>
                            <p>This planner helps you create a systematic investment plan to cover future zakat obligations:</p>
                            
                            <ul>
                                <li><span class="term-highlight">Present Value Calculation:</span> We calculate the lump sum needed today to cover all future zakat payments based on projected inflation.</li>
                                <li><span class="term-highlight">Monthly SIP:</span> We determine the monthly investment required to build the needed corpus over 3 years.</li>
                                <li><span class="term-highlight">Investment Growth:</span> Your investment grows at the specified rate to cover increasing zakat obligations.</li>
                                <li><span class="term-highlight">Safety Buffer:</span> We add a buffer to account for market volatility and higher-than-expected inflation.</li>
                                <li><span class="term-highlight">Coverage Projection:</span> Year-by-year projection shows how your investment covers zakat obligations.</li>
                            </ul>
                        </div>
                        
                        <div class="references">
                            <h3><i class="fas fa-book"></i> Islamic References</h3>
                            <ul>
                                <li>"And spend out of what We have provided for you" - Quran (2:254)</li>
                                <li>Planning for future obligations is encouraged in Islam - Hadith</li>
                                <li>Shariah-compliant investments are permissible - Fiqh Council rulings</li>
                                <li>Wealth preservation is a form of sadaqah jariyah - Islamic finance principles</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="results-section" id="results">
                    <!-- Comparison Results -->
                    <div id="comparison-results">
                        <h2 class="results-header">Gold vs SIP Results</h2>
                        
                        <div class="card-container">
                            <div class="card">
                                <div class="card-content">
                                    <h3><i class="fas fa-crown"></i> Optimal Strategy <span class="badge badge-success">Recommended</span></h3>
                                    <div id="bestCard"></div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-content">
                                    <h3><i class="fas fa-coins"></i> 100% Gold Scenario</h3>
                                    <div id="goldOnlyCard"></div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-content">
                                    <h3><i class="fas fa-trophy"></i> Your Advantage</h3>
                                    <div id="benefitCard"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="section-divider"></div>
                        
                        <div class="chart-container">
                            <canvas id="comparisonChart"></canvas>
                        </div>
                        
                        <div class="table-container">
                            <table class="scenarios-table">
                                <thead>
                                    <tr>
                                        <th>Gold %</th>
                                        <th>SIP %</th>
                                        <th>End Gold Value</th>
                                        <th>End SIP Value</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="rows"></tbody>
                            </table>
                        </div>
                        
                        <div class="info-box">
                            <h3><i class="fas fa-info-circle"></i> How to interpret results</h3>
                            <p>The green row shows the optimal strategy where SIP survives all years and pays zakat. The "Benefit" card shows how much wealth you preserve compared to a 100% gold strategy. Zakat is calculated on the current value of gold at the end of each year and paid from the SIP investment.</p>
                        </div>
                        
                        <div class="success-animation" id="comparisonSuccess">
                            <i class="fas fa-check-circle"></i>
                            <p>Calculation completed successfully!</p>
                        </div>
                        
                        <button class="btn pdf-btn" onclick="generateComparisonPDF()">
                            <i class="fas fa-file-pdf"></i> Download PDF Receipt
                        </button>
                        
                        <div class="disclaimer">
                            <p><strong>Disclaimer:</strong> These calculations are for educational purposes only. Actual results may vary based on market conditions. Consult with a qualified Islamic finance advisor before making investment decisions. Zakat calculations should be verified with your local scholar.</p>
                        </div>
                    </div>
                    
                    <!-- Zakat Calculator Results -->
                    <div id="zakat-results" style="display:none;">
                        <h2 class="results-header">Zakat Calculation Results</h2>
                        
                        <div class="card-container">
                            <div class="card">
                                <div class="card-content">
                                    <h3><i class="fas fa-scale-balanced"></i> Your Zakat Obligation</h3>
                                    <div id="zakatResultCard"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="section-divider"></div>
                        
                        <div class="payment-options">
                            <div class="payment-option">
                                <h4><i class="fas fa-money-bill-wave"></i> Cash Payment</h4>
                                <p id="cashPayment"></p>
                                <p>Pay this amount directly from your savings</p>
                            </div>
                            
                            <div class="payment-option">
                                <h4><i class="fas fa-weight-scale"></i> Gold Equivalent</h4>
                                <p id="goldPayment"></p>
                                <p>Sell this amount of gold to pay zakat</p>
                            </div>
                            
                            <div class="payment-option">
                                <h4><i class="fas fa-chart-line"></i> SIP Alternative</h4>
                                <p id="sipAlternative"></p>
                                <p>Invest this amount to cover future zakat</p>
                                <button class="btn" onclick="switchToPlanner()" style="margin-top: 10px; padding: 10px;">
                                    <i class="fas fa-piggy-bank"></i> Plan SIP
                                </button>
                            </div>
                        </div>
                        
                        <div class="chart-container">
                            <canvas id="zakatChart"></canvas>
                        </div>
                        
                        <div class="success-animation" id="zakatSuccess">
                            <i class="fas fa-check-circle"></i>
                            <p>Calculation completed successfully!</p>
                        </div>
                        
                        <button class="btn pdf-btn" onclick="generateZakatPDF()">
                            <i class="fas fa-file-pdf"></i> Download Zakat Receipt
                        </button>
                        
                        <div class="disclaimer">
                            <p><strong>Important:</strong> This calculator provides estimates only. Zakat calculations should be verified with your local scholar. Gold purity and exact weight measurements may affect actual zakat due.</p>
                        </div>
                    </div>
                    
                    <!-- SIP Planner Results -->
                    <div id="planner-results" style="display:none;">
                        <h2 class="results-header">Zakat SIP Plan</h2>
                        
                        <div class="card-container">
                            <div class="card">
                                <div class="card-content">
                                    <h3><i class="fas fa-sack-dollar"></i> Investment Required <span class="badge badge-primary">Zakat Insurance</span></h3>
                                    <div id="sipInvestmentCard"></div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-content">
                                    <h3><i class="fas fa-calendar-check"></i> Monthly SIP Equivalent</h3>
                                    <div id="monthlySipCard"></div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-content">
                                    <h3><i class="fas fa-shield"></i> Coverage Status</h3>
                                    <div id="coverageCard"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="section-divider"></div>
                        
                        <div class="chart-container">
                            <canvas id="sipChart"></canvas>
                        </div>
                        
                        <div class="coverage-explanation">
                            <h4><i class="fas fa-lightbulb"></i> Understanding Your Coverage Projection</h4>
                            <p>This table shows how your investment will cover zakat obligations over time:</p>
                            <ul>
                                <li><strong>Zakat Due:</strong> The projected zakat amount for each year, increasing with inflation</li>
                                <li><strong>SIP Value:</strong> The expected value of your investment before paying zakat</li>
                                <li><strong>After Zakat:</strong> The remaining investment value after paying zakat</li>
                                <li><strong>Status:</strong> Indicates whether your investment can cover the zakat payment</li>
                            </ul>
                            <p>The plan includes a safety buffer to account for market fluctuations and higher-than-expected inflation.</p>
                        </div>
                        
                        <div class="table-container">
                            <table class="projection-table">
                                <thead>
                                    <tr>
                                        <th>Year</th>
                                        <th>Zakat Due</th>
                                        <th>SIP Value</th>
                                        <th>After Zakat</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="projectionRows"></tbody>
                            </table>
                        </div>
                        
                        <div class="success-animation" id="sipSuccess">
                            <i class="fas fa-check-circle"></i>
                            <p>Calculation completed successfully!</p>
                        </div>
                        
                        <button class="btn pdf-btn" onclick="generatePlannerPDF()">
                            <i class="fas fa-file-pdf"></i> Download SIP Plan Receipt
                        </button>
                        
                        <div class="disclaimer">
                            <p><strong>Investment Disclaimer:</strong> Past performance is not indicative of future results. Market returns are unpredictable. This plan assumes consistent returns which may not reflect actual market conditions.</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <footer>
                <p>Islamic Wealth Shield by <a href="https://www.linkedin.com/in/aayanshaikhacca" class="footer-link" target="_blank">Aayan Shaikh</a> | Helping Muslims preserve wealth while fulfilling religious obligations</p>
                <p class="disclaimer">¬© 2025 Islamic Finance Solutions. All calculations are estimates. Verify with qualified scholars.</p>
            </footer>

            <script>
                // Islamic Wealth Shield Application
                (function() {
                    // Currency and region configuration
                    const regions = {
                        pak: { name: "Pakistan", currency: "PKR", symbol: "‚Ç®", icon: "fa-rupee-sign", goldRate: 18867 },
                        ind: { name: "India", currency: "INR", symbol: "‚Çπ", icon: "fa-rupee-sign", goldRate: 6000 },
                        bang: { name: "Bangladesh", currency: "BDT", symbol: "‡ß≥", icon: "fa-taka-sign", goldRate: 8000 },
                        uae: { name: "UAE", currency: "AED", symbol: "ÿØ.ÿ•", icon: "fa-dirham-sign", goldRate: 220 },
                        us: { name: "International", currency: "USD", symbol: "$", icon: "fa-dollar-sign", goldRate: 60 }
                    };
                    
                    // Investment presets
                    const investmentPresets = {
                        conservative: { sipR: 8, goldR: 6, yrs: 10 },
                        moderate: { sipR: 10, goldR: 7, yrs: 10 },
                        aggressive: { sipR: 12, goldR: 8, yrs: 10 },
                        custom: { sipR: 12, goldR: 8, yrs: 10 }
                    };
                    
                    // SIP planner presets
                    const plannerPresets = {
                        shortterm: { coverYears: 5, sipReturn: 10, zakatInflation: 8, safetyBuffer: 15 },
                        mediumterm: { coverYears: 10, sipReturn: 12, zakatInflation: 8, safetyBuffer: 20 },
                        longterm: { coverYears: 20, sipReturn: 15, zakatInflation: 8, safetyBuffer: 25 },
                        customplan: { coverYears: 10, sipReturn: 12, zakatInflation: 8, safetyBuffer: 20 }
                    };
                    
                    // Current application state
                    let currentRegion = 'pak';
                    let currentMode = 'comparison';
                    let comparisonResults = null;
                    let zakatResults = null;
                    let plannerResults = null;
                    let comparisonChart = null;
                    let zakatChart = null;
                    let sipChart = null;
                    
                    // DOM references
                    const statusEl = document.getElementById('status');
                    const loaderEl = document.getElementById('loader');
                    
                    // Format currency based on region
                    const formatCurrency = (n, region = currentRegion) => {
                        const config = regions[region];
                        return `${config.symbol}${n.toLocaleString('en-IN', { maximumFractionDigits: 0 })}`;
                    };
                    
                    const gramsToTola = grams => (grams / 11.664).toFixed(2);
                    const tolaToGrams = tola => (tola * 11.664).toFixed(2);
                    
                    // Convert tola to grams
                    function convertTolaToGram() {
                        const tolaValue = parseFloat(document.getElementById('tolaInput').value);
                        if (!isNaN(tolaValue)) {
                            document.getElementById('goldWeight').value = tolaToGrams(tolaValue);
                        }
                    }
                    
                    // Set region
                    function setRegion(region) {
                        currentRegion = region;
                        const config = regions[region];
                        
                        // Update currency symbols
                        document.querySelectorAll('.currency-symbol').forEach(el => {
                            el.textContent = config.symbol;
                        });
                        
                        // Update currency icons
                        document.getElementById('currency-icon').className = `fas ${config.icon}`;
                        document.getElementById('gold-rate-icon').className = `fas ${config.icon}`;
                        document.getElementById('zakat-amount-icon').className = `fas ${config.icon}`;
                        
                        // Update gold rate in zakat calculator
                        document.getElementById('goldRate').value = config.goldRate;
                        
                        // Update active button
                        document.querySelectorAll('.region-btn').forEach(btn => {
                            btn.classList.remove('active');
                        });
                        document.querySelector(`.region-btn[data-region="${region}"]`).classList.add('active');
                    }
                    
                    // Set investment preset
                    function setInvestmentPreset(preset) {
                        const config = investmentPresets[preset];
                        document.getElementById('sipR').value = config.sipR;
                        document.getElementById('goldR').value = config.goldR;
                        document.getElementById('yrs').value = config.yrs;
                        
                        // Update active button
                        document.querySelectorAll('#comparison-mode .preset-btn').forEach(btn => {
                            btn.classList.remove('active');
                        });
                        document.querySelector(`#comparison-mode .preset-btn[data-preset="${preset}"]`).classList.add('active');
                    }
                    
                    // Set planner preset
                    function setPlannerPreset(preset) {
                        const config = plannerPresets[preset];
                        document.getElementById('coverYears').value = config.coverYears;
                        document.getElementById('sipReturn').value = config.sipReturn;
                        document.getElementById('zakatInflation').value = config.zakatInflation;
                        document.getElementById('safetyBuffer').value = config.safetyBuffer;
                        
                        // Update active button
                        document.querySelectorAll('#planner-mode .preset-btn').forEach(btn => {
                            btn.classList.remove('active');
                        });
                        document.querySelector(`#planner-mode .preset-btn[data-preset="${preset}"]`).classList.add('active');
                    }
                    
                    // Switch to planner from zakat calculator
                    function switchToPlanner() {
                        const zakatAmount = parseFloat(document.getElementById('zakatAmount').textContent.replace(/[^0-9.-]+/g,""));
                        
                        // Set the annual zakat in planner
                        document.getElementById('annualZakat').value = zakatAmount;
                        
                        // Switch to planner mode
                        switchMode('planner');
                    }
                    
                    // Validate inputs
                    function validateInputs(mode) {
                        let isValid = true;
                        const errorMessages = document.querySelectorAll('.error-message');
                        errorMessages.forEach(el => el.style.display = 'none');
                        
                        // Common validation
                        const validateNumber = (id, min, max, errorId) => {
                            const input = document.getElementById(id);
                            const value = parseFloat(input.value);
                            
                            if (isNaN(value) || value < min || value > max) {
                                input.classList.add('input-error');
                                document.getElementById(errorId).style.display = 'block';
                                isValid = false;
                            } else {
                                input.classList.remove('input-error');
                            }
                        };
                        
                        if (mode === 'comparison') {
                            validateNumber('total', 1000, 1000000000, 'total-error');
                            validateNumber('zakat', 0, 10, 'zakat-error');
                            validateNumber('yrs', 1, 50, 'yrs-error');
                            validateNumber('sipR', -10, 50, 'sipR-error');
                            validateNumber('goldR', -10, 50, 'goldR-error');
                        } else if (mode === 'zakat') {
                            validateNumber('goldWeight', 0, 10000, 'goldWeight-error');
                            validateNumber('goldRate', 1, 1000000, 'goldRate-error');
                            validateNumber('zakatRate', 0, 10, 'zakatRate-error');
                        } else if (mode === 'planner') {
                            validateNumber('annualZakat', 0, 100000000, 'annualZakat-error');
                            validateNumber('coverYears', 1, 50, 'coverYears-error');
                            validateNumber('sipReturn', -10, 50, 'sipReturn-error');
                            validateNumber('zakatInflation', 0, 50, 'zakatInflation-error');
                            validateNumber('safetyBuffer', 0, 100, 'safetyBuffer-error');
                        }
                        
                        return isValid;
                    }
                    
                    // Gold vs SIP Comparison
                    function runComparison() {
                        if (!validateInputs('comparison')) return;
                        
                        // Show progress bar
                        document.getElementById('progressBar').style.display = 'block';
                        const progressFill = document.getElementById('progressFill');
                        
                        // Show loader
                        loaderEl.style.display = 'block';
                        
                        // Get input values
                        const total = +document.getElementById('total').value || 0;
                        const zak = +document.getElementById('zakat').value / 100;
                        const sipP = +document.getElementById('sipR').value / 100;
                        const goldP = +document.getElementById('goldR').value / 100;
                        const yrs = +document.getElementById('yrs').value || 1;
                        
                        // Simulate in background to prevent UI freeze
                        setTimeout(() => {
                            const body = document.getElementById('rows');
                            body.innerHTML = '';
                            let best = null;
                            const results = [];
                            
                            // Simulate different splits
                            for (let g = 95; g >= 50; g -= 5) {
                                let s = 100 - g;
                                let gold = total * g / 100;
                                let sip = total * s / 100;
                                let alive = true;
                                
                                for (let y = 1; y <= yrs; y++) {
                                    // Gold grows first
                                    gold = gold * (1 + goldP);
                                    
                                    // Zakat calculated on current gold value
                                    const zakat = gold * zak;
                                    
                                    // SIP grows
                                    sip = sip * (1 + sipP);
                                    
                                    // Zakat paid from SIP
                                    sip -= zakat;
                                    
                                    if (sip < 0) {
                                        alive = false;
                                        break;
                                    }
                                }
                                
                                if (alive && (!best || g > best.goldPc)) {
                                    best = { goldPc: g, sipPc: s, endGold: gold, endSIP: sip };
                                }
                                
                                results.push({
                                    goldPc: g,
                                    sipPc: s,
                                    endGold: gold,
                                    endSIP: sip,
                                    alive: alive
                                });
                                
                                body.innerHTML += `
                                    <tr class="${alive ? 'optimal-row' : ''}">
                                        <td>${g}%</td>
                                        <td>${s}%</td>
                                        <td>${formatCurrency(gold)}</td>
                                        <td>${formatCurrency(Math.max(0, sip))}</td>
                                        <td class="${alive ? 'success' : 'danger'}">
                                            ${alive ? '‚úÖ Sustainable' : '‚ùå Failed'}
                                        </td>
                                    </tr>`;
                                
                                // Update progress bar
                                progressFill.style.width = `${((95 - g) / 9 * 100)}%`;
                            }
                            
                            // Corrected 100% gold scenario
                            let baseGold = total;
                            let totalZ = 0;
                            
                            for (let y = 1; y <= yrs; y++) {
                                baseGold = baseGold * (1 + goldP); // Gold grows
                                const z = baseGold * zak;          // Zakat calculated
                                baseGold -= z;                     // Zakat paid from gold
                                totalZ += z;                       // Track total zakat
                            }
                            
                            // Populate result cards
                            const bestCard = document.getElementById('bestCard');
                            if (best) {
                                bestCard.innerHTML = `
                                    <p class="value">${best.goldPc}% Gold / ${best.sipPc}% SIP</p>
                                    <p>Gold: ${formatCurrency(best.endGold)}</p>
                                    <p>SIP: ${formatCurrency(best.endSIP)}</p>
                                    <p>Total: ${formatCurrency(best.endGold + best.endSIP)}</p>
                                `;
                            } else {
                                bestCard.innerHTML = '<p class="danger">No sustainable split found</p>';
                            }
                            
                            const goldOnlyCard = document.getElementById('goldOnlyCard');
                            goldOnlyCard.innerHTML = `
                                <p class="value">${formatCurrency(baseGold)}</p>
                                <p>Total Zakat Paid: ${formatCurrency(totalZ)}</p>
                                <p>Effective Value: ${formatCurrency(baseGold + totalZ)}</p>
                            `;
                            
                            const benefitCard = document.getElementById('benefitCard');
                            let net = 0;
                            if (best) {
                                net = (best.endGold + best.endSIP) - baseGold;
                                const txt = net >= 0 ? 
                                    `You preserved ${formatCurrency(net)} more wealth` : 
                                    `You lost ${formatCurrency(-net)} vs 100% gold`;
                                    
                                benefitCard.innerHTML = `
                                    <p class="value">${txt}</p>
                                    <p>Zakat Efficiency: ${(net/total*100).toFixed(1)}%</p>
                                `;
                            } else {
                                benefitCard.innerHTML = '<p>No benefit calculation available</p>';
                            }
                            
                            // Store results for PDF
                            comparisonResults = {
                                bestStrategy: best ? `${best.goldPc}% Gold / ${best.sipPc}% SIP` : 'N/A',
                                bestGold: best ? formatCurrency(best.endGold) : 'N/A',
                                bestSIP: best ? formatCurrency(best.endSIP) : 'N/A',
                                bestTotal: best ? formatCurrency(best.endGold + best.endSIP) : 'N/A',
                                goldOnlyValue: formatCurrency(baseGold),
                                goldOnlyZakat: formatCurrency(totalZ),
                                advantage: best ? (net >= 0 ? `Preserved ${formatCurrency(net)}` : `Lost ${formatCurrency(-net)}`) : 'N/A',
                                totalInvestment: formatCurrency(total),
                                years: yrs,
                                zakatRate: zak * 100,
                                sipReturn: document.getElementById('sipR').value,
                                goldReturn: document.getElementById('goldR').value
                            };
                            
                            // Create comparison chart
                            createComparisonChart(results, baseGold, best);
                            
                            // Hide loader and progress bar
                            loaderEl.style.display = 'none';
                            document.getElementById('progressBar').style.display = 'none';
                            
                            // Show success animation
                            document.getElementById('comparisonSuccess').style.display = 'block';
                            setTimeout(() => {
                                document.getElementById('comparisonSuccess').style.display = 'none';
                            }, 3000);
                            
                            // Show comparison results
                            document.querySelectorAll('#results > div').forEach(div => {
                                div.style.display = 'none';
                            });
                            document.getElementById('comparison-results').style.display = 'block';
                            document.getElementById('results').style.display = 'block';
                            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
                        }, 100);
                    }
                    
                    // Create comparison chart
                    function createComparisonChart(results, goldOnlyValue, bestStrategy) {
                        const ctx = document.getElementById('comparisonChart').getContext('2d');
                        
                        // Destroy previous chart if exists
                        if (comparisonChart) {
                            comparisonChart.destroy();
                        }
                        
                        // Prepare data
                        const labels = [];
                        const totalValues = [];
                        const backgroundColors = [];
                        
                        // Add gold-only scenario
                        labels.push('100% Gold');
                        totalValues.push(goldOnlyValue);
                        backgroundColors.push('#b68c5a');
                        
                        // Add other strategies
                        results.forEach(result => {
                            const total = result.endGold + result.endSIP;
                            labels.push(`${result.goldPc}% Gold / ${result.sipPc}% SIP`);
                            totalValues.push(total);
                            
                            if (bestStrategy && result.goldPc === bestStrategy.goldPc) {
                                backgroundColors.push('#4a7b4d'); // Highlight best strategy
                            } else if (result.alive) {
                                backgroundColors.push('#8e7037'); // Sustainable strategies
                            } else {
                                backgroundColors.push('#a44a3f'); // Failed strategies
                            }
                        });
                        
                        // Create chart
                        comparisonChart = new Chart(ctx, {
                            type: 'bar',
                            data: {
                                labels: labels,
                                datasets: [{
                                    label: 'Final Wealth Value',
                                    data: totalValues,
                                    backgroundColor: backgroundColors,
                                    borderColor: '#3d2e1f',
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        display: false
                                    },
                                    tooltip: {
                                        callbacks: {
                                            label: function(context) {
                                                return `Value: ${formatCurrency(context.raw)}`;
                                            }
                                        }
                                    }
                                },
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        ticks: {
                                            callback: function(value) {
                                                return formatCurrency(value);
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    }
                    
                    // Zakat Calculator
                    function calculateZakat() {
                        if (!validateInputs('zakat')) return;
                        
                        // Show progress bar
                        document.getElementById('zakatProgressBar').style.display = 'block';
                        const progressFill = document.getElementById('zakatProgressFill');
                        progressFill.style.width = '30%';
                        
                        // Show loader
                        loaderEl.style.display = 'block';
                        
                        setTimeout(() => {
                            const weight = +document.getElementById('goldWeight').value || 0;
                            const rate = +document.getElementById('goldRate').value || 0;
                            const zakatRate = +document.getElementById('zakatRate').value / 100 || 0;
                            const otherAssets = +document.getElementById('otherAssets').value || 0;
                            const purity = +document.getElementById('goldPurity').value || 22;
                            
                            // Update progress
                            progressFill.style.width = '70%';
                            
                            // Adjust weight for purity (22K is standard)
                            const purityFactor = purity / 24;
                            const adjustedWeight = weight * purityFactor;
                            
                            // Nisab threshold (87.48 grams for pure gold)
                            const nisab = 87.48;
                            const goldValue = adjustedWeight * rate;
                            const totalZakatable = goldValue + otherAssets;
                            const zakatDue = totalZakatable * zakatRate;
                            
                            // Display results
                            const zakatResultCard = document.getElementById('zakatResultCard');
                            
                            if (adjustedWeight < nisab) {
                                zakatResultCard.innerHTML = `
                                    <p class="value">No Zakat Due</p>
                                    <p>Your gold (${adjustedWeight.toFixed(2)}g pure equivalent) is below nisab threshold (87.48g)</p>
                                    <p>Total gold value: ${formatCurrency(goldValue)}</p>
                                `;
                                
                                // Hide payment options if no zakat due
                                document.querySelector('.payment-options').style.display = 'none';
                                
                                // Store results for PDF
                                zakatResults = {
                                    status: "No Zakat Due",
                                    weight: `${weight}g (${gramsToTola(weight)} tola)`,
                                    purity: `${purity}K`,
                                    pureEquivalent: `${adjustedWeight.toFixed(2)}g`,
                                    rate: formatCurrency(rate),
                                    goldValue: formatCurrency(goldValue),
                                    zakatDue: "0",
                                    nisabThreshold: "87.48g"
                                };
                            } else {
                                zakatResultCard.innerHTML = `
                                    <p class="value">${formatCurrency(zakatDue)}</p>
                                    <p>Gold: ${weight}g (${gramsToTola(weight)} tola) @ ${formatCurrency(rate)}/g</p>
                                    <p>Purity: ${purity}K (${purityFactor*100}% pure)</p>
                                    <p>Pure Gold Equivalent: ${adjustedWeight.toFixed(2)}g</p>
                                    <p>Gold Value: ${formatCurrency(goldValue)}</p>
                                    <p>Zakat Rate: ${(zakatRate*100)}%</p>
                                `;
                                
                                // Store zakat amount for SIP planner
                                zakatResultCard.innerHTML += `<div id="zakatAmount" style="display:none;">${zakatDue}</div>`;
                                
                                // Show payment options
                                document.querySelector('.payment-options').style.display = 'grid';
                                
                                // Payment options
                                document.getElementById('cashPayment').textContent = formatCurrency(zakatDue);
                                
                                const goldPaymentGrams = (zakatDue / rate).toFixed(2);
                                document.getElementById('goldPayment').textContent = `${goldPaymentGrams}g (${gramsToTola(goldPaymentGrams)} tola)`;
                                
                                // SIP alternative calculation (cover 10 years with 12% return)
                                const years = 10;
                                const sipReturn = 0.12;
                                let pv = 0;
                                
                                for (let y = 1; y <= years; y++) {
                                    pv += zakatDue * Math.pow(1 + 0.08, y-1) / Math.pow(1 + sipReturn, y);
                                }
                                
                                document.getElementById('sipAlternative').textContent = formatCurrency(pv);
                                
                                // Store results for PDF
                                zakatResults = {
                                    status: "Zakat Due",
                                    weight: `${weight}g (${gramsToTola(weight)} tola)`,
                                    purity: `${purity}K`,
                                    pureEquivalent: `${adjustedWeight.toFixed(2)}g`,
                                    rate: formatCurrency(rate),
                                    goldValue: formatCurrency(goldValue),
                                    zakatDue: formatCurrency(zakatDue),
                                    cashPayment: formatCurrency(zakatDue),
                                    goldPayment: `${goldPaymentGrams}g (${gramsToTola(goldPaymentGrams)} tola)`,
                                    sipAlternative: formatCurrency(pv),
                                    nisabThreshold: "87.48g"
                                };
                            }
                            
                            // Create zakat chart
                            createZakatChart(adjustedWeight, nisab, goldValue, zakatDue);
                            
                            // Hide loader and progress bar
                            loaderEl.style.display = 'none';
                            document.getElementById('zakatProgressBar').style.display = 'none';
                            progressFill.style.width = '100%';
                            
                            // Show success animation
                            document.getElementById('zakatSuccess').style.display = 'block';
                            setTimeout(() => {
                                document.getElementById('zakatSuccess').style.display = 'none';
                            }, 3000);
                            
                            // Show zakat results
                            document.querySelectorAll('#results > div').forEach(div => {
                                div.style.display = 'none';
                            });
                            document.getElementById('zakat-results').style.display = 'block';
                            document.getElementById('results').style.display = 'block';
                            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
                        }, 100);
                    }
                    
                    // Create zakat chart
                    function createZakatChart(adjustedWeight, nisab, goldValue, zakatDue) {
                        const ctx = document.getElementById('zakatChart').getContext('2d');
                        
                        // Destroy previous chart if exists
                        if (zakatChart) {
                            zakatChart.destroy();
                        }
                        
                        // Prepare data
                        const labels = ['Gold Value', 'Zakat Due'];
                        const data = [goldValue, zakatDue];
                        const backgroundColors = ['#b68c5a', '#4a7b4d'];
                        
                        // Add nisab threshold indicator
                        const annotations = [];
                        if (adjustedWeight < nisab) {
                            annotations.push({
                                type: 'line',
                                mode: 'horizontal',
                                scaleID: 'y',
                                value: 0,
                                borderColor: '#a44a3f',
                                borderWidth: 2,
                                borderDash: [5, 5],
                                label: {
                                    backgroundColor: '#a44a3f',
                                    content: 'Below Nisab Threshold',
                                    position: 'start'
                                }
                            });
                        }
                        
                        // Create chart
                        zakatChart = new Chart(ctx, {
                            type: 'doughnut',
                            data: {
                                labels: labels,
                                datasets: [{
                                    data: data,
                                    backgroundColor: backgroundColors,
                                    borderColor: '#3d2e1f',
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: 'top',
                                    },
                                    tooltip: {
                                        callbacks: {
                                            label: function(context) {
                                                return `${context.label}: ${formatCurrency(context.raw)}`;
                                            }
                                        }
                                    },
                                    annotation: {
                                        annotations: annotations
                                    }
                                },
                                cutout: '60%'
                            }
                        });
                    }
                    
                    // Zakat SIP Planner
                    function planSIP() {
                        if (!validateInputs('planner')) return;
                        
                        // Show progress bar
                        document.getElementById('sipProgressBar').style.display = 'block';
                        const progressFill = document.getElementById('sipProgressFill');
                        progressFill.style.width = '30%';
                        
                        // Show loader
                        loaderEl.style.display = 'block';
                        
                        setTimeout(() => {
                            const annualZakat = +document.getElementById('annualZakat').value || 0;
                            const years = +document.getElementById('coverYears').value || 10;
                            const sipReturn = +document.getElementById('sipReturn').value / 100 || 0;
                            const zakatInflation = +document.getElementById('zakatInflation').value / 100 || 0;
                            const safetyBuffer = 1 + (+document.getElementById('safetyBuffer').value / 100 || 0);
                            
                            // Update progress
                            progressFill.style.width = '60%';
                            
                            // Calculate present value of future zakat obligations
                            let pv = 0;
                            const projection = [];
                            
                            for (let y = 1; y <= years; y++) {
                                const zakatAmount = annualZakat * Math.pow(1 + zakatInflation, y-1) * safetyBuffer;
                                const discounted = zakatAmount / Math.pow(1 + sipReturn, y);
                                pv += discounted;
                                
                                projection.push({
                                    year: y,
                                    zakatDue: zakatAmount,
                                    discounted: discounted
                                });
                            }
                            
                            // Calculate monthly SIP equivalent (3 years to build corpus)
                            const monthlyRate = Math.pow(1 + sipReturn, 1/12) - 1;
                            const months = 36; // 3 years
                            const monthlySip = pv * monthlyRate / (1 - Math.pow(1 + monthlyRate, -months));
                            
                            // Display results
                            document.getElementById('sipInvestmentCard').innerHTML = `
                                <p class="value">${formatCurrency(pv)}</p>
                                <p>To cover ${years} years of zakat</p>
                                <p>With ${(sipReturn*100).toFixed(1)}% returns</p>
                            `;
                            
                            document.getElementById('monthlySipCard').innerHTML = `
                                <p class="value">${formatCurrency(monthlySip)}</p>
                                <p>For 3 years to build corpus</p>
                                <p>Then let it grow for payments</p>
                            `;
                            
                            // Coverage status
                            const coverageCard = document.getElementById('coverageCard');
                            const coverageRatio = (pv / (annualZakat * years)) * 100;
                            let coverageStatus = '';
                            
                            if (coverageRatio >= 100) {
                                coverageCard.innerHTML = `
                                    <p class="value">‚úÖ Fully Covered</p>
                                    <p>Your investment covers ${years} years with buffer</p>
                                    <p>Safety margin: ${(coverageRatio - 100).toFixed(1)}%</p>
                                `;
                                coverageStatus = `Fully Covered (${years} years with ${(coverageRatio - 100).toFixed(1)}% margin)`;
                            } else {
                                coverageCard.innerHTML = `
                                    <p class="value">‚ö†Ô∏è Partial Coverage</p>
                                    <p>Your investment covers ${(coverageRatio / 100 * years).toFixed(1)} years</p>
                                    <p>Consider increasing investment by ${formatCurrency((annualZakat * years) - pv)}</p>
                                `;
                                coverageStatus = `Partial Coverage (${(coverageRatio / 100 * years).toFixed(1)} of ${years} years)`;
                            }
                            
                            // Store results for PDF
                            plannerResults = {
                                annualZakat: formatCurrency(annualZakat),
                                coverYears: years,
                                sipReturn: `${(sipReturn*100).toFixed(1)}%`,
                                zakatInflation: `${(zakatInflation*100).toFixed(1)}%`,
                                safetyBuffer: `${((safetyBuffer-1)*100).toFixed(0)}%`,
                                investmentRequired: formatCurrency(pv),
                                monthlySIP: formatCurrency(monthlySip),
                                coverageStatus: coverageStatus
                            };
                            
                            // Yearly projection
                            let projectionHTML = '';
                            let sipValue = pv;
                            const chartData = [];
                            
                            projection.forEach(item => {
                                sipValue = sipValue * (1 + sipReturn);
                                const afterZakat = sipValue - item.zakatDue;
                                const status = afterZakat >= 0 ? 'Covered' : 'Shortfall';
                                
                                projectionHTML += `
                                    <tr>
                                        <td>${item.year}</td>
                                        <td>${formatCurrency(item.zakatDue)}</td>
                                        <td>${formatCurrency(sipValue)}</td>
                                        <td>${formatCurrency(Math.max(0, afterZakat))}</td>
                                        <td class="${afterZakat >= 0 ? 'success' : 'danger'}">${status}</td>
                                    </tr>
                                `;
                                
                                // Add to chart data
                                chartData.push({
                                    year: item.year,
                                    zakatDue: item.zakatDue,
                                    sipValue: sipValue,
                                    afterZakat: afterZakat
                                });
                                
                                sipValue = Math.max(0, afterZakat);
                            });
                            
                            document.getElementById('projectionRows').innerHTML = projectionHTML;
                            
                            // Create SIP chart
                            createSIPChart(chartData);
                            
                            // Update progress
                            progressFill.style.width = '100%';
                            
                            // Hide loader and progress bar
                            loaderEl.style.display = 'none';
                            document.getElementById('sipProgressBar').style.display = 'none';
                            
                            // Show success animation
                            document.getElementById('sipSuccess').style.display = 'block';
                            setTimeout(() => {
                                document.getElementById('sipSuccess').style.display = 'none';
                            }, 3000);
                            
                            // Show planner results
                            document.querySelectorAll('#results > div').forEach(div => {
                                div.style.display = 'none';
                            });
                            document.getElementById('planner-results').style.display = 'block';
                            document.getElementById('results').style.display = 'block';
                            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
                        }, 100);
                    }
                    
                    // Create SIP chart
                    function createSIPChart(data) {
                        const ctx = document.getElementById('sipChart').getContext('2d');
                        
                        // Destroy previous chart if exists
                        if (sipChart) {
                            sipChart.destroy();
                        }
                        
                        // Prepare data
                        const labels = data.map(item => `Year ${item.year}`);
                        const sipValues = data.map(item => item.sipValue);
                        const zakatDue = data.map(item => item.zakatDue);
                        
                        // Create chart
                        sipChart = new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: labels,
                                datasets: [
                                    {
                                        label: 'SIP Value',
                                        data: sipValues,
                                        backgroundColor: 'rgba(142, 112, 55, 0.2)',
                                        borderColor: '#8e7037',
                                        borderWidth: 3,
                                        fill: true,
                                        tension: 0.3
                                    },
                                    {
                                        label: 'Zakat Due',
                                        data: zakatDue,
                                        backgroundColor: 'rgba(74, 123, 77, 0.2)',
                                        borderColor: '#4a7b4d',
                                        borderWidth: 2,
                                        borderDash: [5, 5],
                                        fill: false,
                                        tension: 0.3
                                    }
                                ]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    tooltip: {
                                        callbacks: {
                                            label: function(context) {
                                                return `${context.dataset.label}: ${formatCurrency(context.raw)}`;
                                            }
                                        }
                                    }
                                },
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        ticks: {
                                            callback: function(value) {
                                                return formatCurrency(value);
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    }
                    
                    // Generate PDF Receipts
                    function generateComparisonPDF() {
                        if (!comparisonResults) {
                            alert("Please run the comparison first to generate a receipt");
                            return;
                        }
                        
                        const { bestStrategy, bestGold, bestSIP, bestTotal, goldOnlyValue, goldOnlyZakat, advantage, totalInvestment, years, zakatRate, sipReturn, goldReturn } = comparisonResults;
                        
                        const detailsHTML = `
                            <h3>Comparison Results Summary</h3>
                            <p><strong>Total Investment:</strong> <span class="value">${totalInvestment}</span></p>
                            <p><strong>Years:</strong> ${years}</p>
                            <p><strong>Zakat Rate:</strong> ${zakatRate}%</p>
                            <p><strong>SIP Return:</strong> ${sipReturn}%</p>
                            <p><strong>Gold Return:</strong> ${goldReturn}%</p>
                            
                            <h3>Optimal Strategy</h3>
                            <p><strong>Strategy:</strong> <span class="value">${bestStrategy}</span></p>
                            <p><strong>Gold Value:</strong> <span class="value">${bestGold}</span></p>
                            <p><strong>SIP Value:</strong> <span class="value">${bestSIP}</span></p>
                            <p><strong>Total Value:</strong> <span class="value">${bestTotal}</span></p>
                            
                            <h3>100% Gold Scenario</h3>
                            <p><strong>Final Value:</strong> <span class="value">${goldOnlyValue}</span></p>
                            <p><strong>Total Zakat Paid:</strong> <span class="value">${goldOnlyZakat}</span></p>
                            
                            <h3>Your Advantage</h3>
                            <p><span class="value">${advantage}</span></p>
                        `;
                        
                        document.getElementById('receiptDetails').innerHTML = detailsHTML;
                        document.getElementById('receiptDate').textContent = new Date().toLocaleDateString('en-GB', { 
                            day: 'numeric', 
                            month: 'long', 
                            year: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                        
                        document.getElementById('receiptContainer').style.display = 'block';
                    }
                    
                    function generateZakatPDF() {
                        if (!zakatResults) {
                            alert("Please calculate zakat first to generate a receipt");
                            return;
                        }
                        
                        const { status, weight, purity, pureEquivalent, rate, goldValue, zakatDue, cashPayment, goldPayment, sipAlternative, nisabThreshold } = zakatResults;
                        
                        const detailsHTML = `
                            <h3>Zakat Calculation Summary</h3>
                            <p><strong>Status:</strong> <span class="value">${status}</span></p>
                            <p><strong>Nisab Threshold:</strong> ${nisabThreshold}</p>
                            <p><strong>Gold Weight:</strong> ${weight}</p>
                            <p><strong>Gold Purity:</strong> ${purity}K</p>
                            <p><strong>Pure Gold Equivalent:</strong> ${pureEquivalent}g</p>
                            <p><strong>Gold Rate:</strong> <span class="value">${rate}</span> per gram</p>
                            <p><strong>Gold Value:</strong> <span class="value">${goldValue}</span></p>
                            ${status === "Zakat Due" ? `
                                <p><strong>Zakat Due:</strong> <span class="value">${zakatDue}</span></p>
                                
                                <h3>Payment Options</h3>
                                <p><strong>Cash Payment:</strong> <span class="value">${cashPayment}</span></p>
                                <p><strong>Gold Equivalent:</strong> <span class="value">${goldPayment}</span></p>
                                <p><strong>SIP Alternative (10-year coverage):</strong> <span class="value">${sipAlternative}</span></p>
                            ` : ''}
                        `;
                        
                        document.getElementById('receiptDetails').innerHTML = detailsHTML;
                        document.getElementById('receiptDate').textContent = new Date().toLocaleDateString('en-GB', { 
                            day: 'numeric', 
                            month: 'long', 
                            year: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                        
                        document.getElementById('receiptContainer').style.display = 'block';
                    }
                    
                    function generatePlannerPDF() {
                        if (!plannerResults) {
                            alert("Please plan SIP first to generate a receipt");
                            return;
                        }
                        
                        const { annualZakat, coverYears, sipReturn, zakatInflation, safetyBuffer, investmentRequired, monthlySIP, coverageStatus } = plannerResults;
                        
                        const detailsHTML = `
                            <h3>SIP Plan Summary</h3>
                            <p><strong>Annual Zakat:</strong> <span class="value">${annualZakat}</span></p>
                            <p><strong>Coverage Years:</strong> ${coverYears} years</p>
                            <p><strong>SIP Return:</strong> ${sipReturn}</p>
                            <p><strong>Zakat Inflation:</strong> ${zakatInflation}</p>
                            <p><strong>Safety Buffer:</strong> ${safetyBuffer}</p>
                            
                            <h3>Investment Details</h3>
                            <p><strong>Investment Required:</strong> <span class="value">${investmentRequired}</span></p>
                            <p><strong>Monthly SIP (3-year build):</strong> <span class="value">${monthlySIP}</span></p>
                            <p><strong>Coverage Status:</strong> <span class="value">${coverageStatus}</span></p>
                        `;
                        
                        document.getElementById('receiptDetails').innerHTML = detailsHTML;
                        document.getElementById('receiptDate').textContent = new Date().toLocaleDateString('en-GB', { 
                            day: 'numeric', 
                            month: 'long', 
                            year: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                        
                        document.getElementById('receiptContainer').style.display = 'block';
                    }
                    
                    function closeReceipt() {
                        document.getElementById('receiptContainer').style.display = 'none';
                    }
                    
                    function downloadPDF() {
                        const receiptContent = document.getElementById('receiptContent');
                        const { jsPDF } = window.jspdf;
                        
                        html2canvas(receiptContent, {
                            scale: 2,
                            useCORS: true
                        }).then(canvas => {
                            const imgData = canvas.toDataURL('image/png');
                            const pdf = new jsPDF('p', 'mm', 'a4');
                            const imgWidth = 210; 
                            const pageHeight = 297;
                            const imgHeight = canvas.height * imgWidth / canvas.width;
                            let heightLeft = imgHeight;
                            let position = 0;
                            
                            pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                            heightLeft -= pageHeight;
                            
                            // Add new page if content is too long
                            while (heightLeft >= 0) {
                                position = heightLeft - imgHeight;
                                pdf.addPage();
                                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                                heightLeft -= pageHeight;
                            }
                            
                            pdf.save(`Islamic-Wealth-Shield-${currentMode}-${new Date().toISOString().slice(0,10)}.pdf`);
                        });
                    }
                    
                    // Switch between modes
                    function switchMode(mode) {
                        currentMode = mode;
                        
                        // Update active button
                        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                        document.querySelector(`.mode-btn[data-mode="${mode}"]`).classList.add('active');
                        
                        // Hide all mode sections
                        document.querySelectorAll('.mode-section').forEach(section => {
                            section.classList.remove('active');
                        });
                        
                        // Show current mode section
                        document.getElementById(`${mode}-mode`).classList.add('active');
                        
                        // Hide all results
                        document.querySelectorAll('#results > div').forEach(div => {
                            div.style.display = 'none';
                        });
                        
                        // Show results for current mode
                        document.getElementById(`${mode}-results`).style.display = 'block';
                        document.getElementById('results').style.display = 'block';
                        
                        // Show status indicator
                        statusEl.textContent = `Switched to ${mode === 'comparison' ? 'Gold vs SIP' : mode === 'zakat' ? 'Zakat Calculator' : 'SIP Planner'} mode`;
                        statusEl.style.display = 'block';
                        statusEl.style.background = mode === 'comparison' ? '#8e7037' : mode === 'zakat' ? '#4a7b4d' : '#b68c5a';
                        
                        setTimeout(() => {
                            statusEl.style.display = 'none';
                        }, 2000);
                    }
                    
                    // Initialize
                    function init() {
                        // Set up mode switching
                        document.querySelectorAll('.mode-btn').forEach(btn => {
                            btn.addEventListener('click', function() {
                                const mode = this.dataset.mode;
                                switchMode(mode);
                            });
                        });
                        
                        // Set up help toggles
                        document.querySelectorAll('.help-toggle').forEach(toggle => {
                            toggle.addEventListener('click', function() {
                                const helpContent = this.nextElementSibling;
                                helpContent.style.display = helpContent.style.display === 'block' ? 'none' : 'block';
                            });
                        });
                        
                        // Set up other event listeners
                        setRegion('pak');
                        setInvestmentPreset('aggressive');
                        setPlannerPreset('mediumterm');
                        
                        // Add event listeners for preset buttons
                        document.querySelectorAll('#comparison-mode .preset-btn').forEach(btn => {
                            btn.addEventListener('click', function() {
                                setInvestmentPreset(this.dataset.preset);
                            });
                        });
                        
                        document.querySelectorAll('#planner-mode .preset-btn').forEach(btn => {
                            btn.addEventListener('click', function() {
                                setPlannerPreset(this.dataset.preset);
                            });
                        });
                        
                        // Add event listeners for region buttons
                        document.querySelectorAll('.region-btn').forEach(btn => {
                            btn.addEventListener('click', function() {
                                setRegion(this.dataset.region);
                            });
                        });
                        
                        // Run comparison by default
                        runComparison();
                    }
                    
                    // Initialize when DOM is loaded
                    document.addEventListener('DOMContentLoaded', init);
                    
                    // Make functions accessible from HTML
                    window.runComparison = runComparison;
                    window.calculateZakat = calculateZakat;
                    window.planSIP = planSIP;
                    window.convertTolaToGram = convertTolaToGram;
                    window.switchToPlanner = switchToPlanner;
                    window.generateComparisonPDF = generateComparisonPDF;
                    window.generateZakatPDF = generateZakatPDF;
                    window.generatePlannerPDF = generatePlannerPDF;
                    window.downloadPDF = downloadPDF;
                    window.closeReceipt = closeReceipt;
                    window.switchMode = switchMode;
                })();
            </script>
        </body>
        </html>